<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trailing Ivy Caf√©</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<!-- Supabase CDN - reliable UMD build -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
<style>
:root{--cream:#F5EFE4;--warm-white:#FAF7F2;--espresso:#2C1810;--dark-roast:#1A0F0A;--caramel:#C8854A;--latte:#D4A574;--mocha:#6B3F2A;--steam:#E8DDD0;--foam:#F0EAE0;--ivy:#3D6B4A;--ivy-light:#5A8F69;--red:#B85450;--amber:#D4A017;--shadow:rgba(44,24,16,0.12)}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--espresso);min-height:100vh}

/* LOGIN */
#login-screen{position:fixed;inset:0;z-index:999;display:flex;align-items:center;justify-content:center;background:linear-gradient(145deg,var(--dark-roast),#2C1810,#1E3A28)}
.login-box{background:var(--warm-white);border-radius:24px;padding:44px 40px;width:92%;max-width:400px;box-shadow:0 32px 80px rgba(0,0,0,0.4);animation:pop .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes pop{from{opacity:0;transform:scale(.9) translateY(20px)}to{opacity:1;transform:none}}
.login-icon{width:60px;height:60px;border-radius:18px;background:linear-gradient(135deg,var(--ivy),var(--espresso));display:flex;align-items:center;justify-content:center;font-size:26px;margin:0 auto 12px;box-shadow:0 8px 24px rgba(61,107,74,.3)}
.login-title{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;text-align:center}
.login-sub{font-size:13px;color:var(--mocha);text-align:center;margin-bottom:24px;font-style:italic}
.role-tabs{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px}
.role-tab{padding:11px;border-radius:10px;border:2px solid var(--steam);background:var(--foam);cursor:pointer;text-align:center;transition:all .2s;font-family:'DM Sans',sans-serif}
.role-tab.active{border-color:var(--ivy);background:rgba(61,107,74,.08)}
.role-tab-icon{font-size:20px;display:block;margin-bottom:3px}
.role-tab-name{font-size:13px;font-weight:600}
.role-tab-desc{font-size:11px;color:var(--mocha)}
.lbl{display:block;font-size:11px;font-weight:600;letter-spacing:.6px;text-transform:uppercase;color:var(--mocha);margin-bottom:5px}
.inp{width:100%;background:var(--foam);border:1.5px solid var(--steam);border-radius:10px;padding:11px 14px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--espresso);outline:none;transition:border .2s;margin-bottom:14px}
.inp:focus{border-color:var(--ivy);box-shadow:0 0 0 3px rgba(61,107,74,.1)}
.login-btn{width:100%;padding:13px;border:none;border-radius:10px;background:linear-gradient(135deg,var(--ivy),#2D5438);color:white;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(61,107,74,.35)}
.login-err{background:rgba(184,84,80,.1);color:var(--red);border:1px solid rgba(184,84,80,.2);border-radius:8px;padding:9px 13px;font-size:13px;margin-top:10px;display:none}
.login-hint{font-size:12px;color:var(--mocha);text-align:center;margin-top:14px;line-height:1.6}

/* LOADING */
#loader{position:fixed;inset:0;z-index:500;background:rgba(245,239,228,.92);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;flex-direction:column;gap:12px}
#loader.on{display:flex}
.spin{width:38px;height:38px;border:3px solid var(--steam);border-top-color:var(--ivy);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.load-txt{font-size:13px;color:var(--mocha)}

/* APP */
.app{display:flex;flex-direction:column;min-height:100vh}
nav{background:var(--espresso);display:flex;align-items:center;justify-content:space-between;padding:0 24px;height:62px;box-shadow:0 4px 24px rgba(44,24,16,.22);position:sticky;top:0;z-index:100}
.nav-logo{font-family:'Playfair Display',serif;font-size:18px;color:var(--latte);display:flex;align-items:center;gap:8px}
.nav-badge{background:linear-gradient(135deg,var(--ivy),#2D5438);padding:4px 9px;border-radius:6px;font-size:10px;color:rgba(255,255,255,.85);font-family:'DM Sans',sans-serif;font-weight:600;letter-spacing:.5px}
.nav-tabs{display:flex;gap:3px}
.nav-tab{background:none;border:none;cursor:pointer;color:rgba(245,239,228,.5);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;padding:7px 14px;border-radius:7px;transition:all .2s}
.nav-tab:hover{color:var(--latte);background:rgba(200,133,74,.1)}
.nav-tab.active{color:var(--cream);background:rgba(200,133,74,.18)}
.nav-right{display:flex;align-items:center;gap:8px}
.nav-user{color:var(--steam);font-size:13px;display:flex;align-items:center;gap:7px}
.avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--ivy),var(--espresso));display:flex;align-items:center;justify-content:center;color:var(--cream);font-size:11px;font-weight:700;border:2px solid rgba(61,107,74,.5)}
.logout-btn{background:rgba(184,84,80,.15);border:1px solid rgba(184,84,80,.25);color:#D47470;padding:5px 11px;border-radius:7px;font-size:12px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s}
.logout-btn:hover{background:rgba(184,84,80,.25)}

main{flex:1;padding:26px 28px;max-width:1380px;margin:0 auto;width:100%}
.panel{display:none}
.panel.active{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:none}}

/* PAGE HEADER */
.ph{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:22px}
.pt{font-family:'Playfair Display',serif;font-size:26px;font-weight:700}
.ps{font-size:13px;color:var(--mocha);margin-top:2px}
.dbadge{background:var(--espresso);color:var(--latte);padding:7px 14px;border-radius:20px;font-family:'DM Mono',monospace;font-size:12px}

/* STATS */
.sg{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:22px}
.sc{background:var(--warm-white);border:1px solid var(--steam);border-radius:14px;padding:16px 18px;position:relative;overflow:hidden;box-shadow:0 2px 12px var(--shadow);transition:transform .2s}
.sc:hover{transform:translateY(-2px)}
.sc::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--caramel),var(--latte))}
.sc.g::after{background:linear-gradient(90deg,var(--ivy),var(--ivy-light))}
.sc.r::after{background:linear-gradient(90deg,var(--red),#D47470)}
.sc.a::after{background:linear-gradient(90deg,var(--amber),#E8C44A)}
.sl{font-size:11px;font-weight:600;letter-spacing:.8px;text-transform:uppercase;color:var(--mocha);margin-bottom:6px}
.sv{font-family:'Playfair Display',serif;font-size:28px;line-height:1}
.ss{font-size:12px;color:var(--mocha);margin-top:3px}

/* CARD */
.card{background:var(--warm-white);border:1px solid var(--steam);border-radius:14px;box-shadow:0 2px 14px var(--shadow);overflow:hidden;margin-bottom:18px}
.ch{padding:14px 20px;border-bottom:1px solid var(--steam);display:flex;align-items:center;justify-content:space-between;background:var(--foam)}
.ct{font-family:'Playfair Display',serif;font-size:16px;font-weight:600}
.cb{padding:20px}

/* TABLE */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse}
thead th{font-size:11px;font-weight:600;letter-spacing:.8px;text-transform:uppercase;color:var(--mocha);padding:9px 13px;text-align:left;background:var(--foam);border-bottom:1px solid var(--steam)}
tbody td{padding:10px 13px;font-size:14px;border-bottom:1px solid rgba(232,221,208,.5)}
tbody tr:last-child td{border-bottom:none}
tbody tr:hover{background:var(--foam)}

/* BADGE */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:12px;font-weight:500}
.bp{background:rgba(61,107,74,.12);color:var(--ivy)}
.ba{background:rgba(184,84,80,.12);color:var(--red)}
.bw{background:rgba(212,160,23,.12);color:var(--amber)}
.bl{background:rgba(200,133,74,.15);color:var(--caramel)}
.br{background:rgba(107,63,42,.1);color:var(--mocha)}

/* BUTTONS */
.btn{border:none;cursor:pointer;border-radius:9px;font-family:'DM Sans',sans-serif;font-weight:500;transition:all .2s;display:inline-flex;align-items:center;gap:5px}
.btn-p{background:var(--espresso);color:var(--cream);padding:9px 18px;font-size:13px}
.btn-p:hover{background:var(--mocha)}
.btn-ivy{background:var(--ivy);color:white;padding:9px 18px;font-size:13px}
.btn-ivy:hover{background:#2D5438}
.btn-sm{padding:5px 12px;font-size:12px;border-radius:7px}
.btn-o{background:none;border:1px solid var(--steam);color:var(--espresso);padding:7px 14px;font-size:12px}
.btn-o:hover{border-color:var(--caramel);color:var(--caramel)}
.btn-g{background:var(--ivy);color:white}
.btn-c{background:var(--caramel);color:white}
.btn-r{background:var(--red);color:white}

/* FORM */
.fg{margin-bottom:14px}
.lbl2{display:block;font-size:11px;font-weight:600;letter-spacing:.4px;text-transform:uppercase;color:var(--mocha);margin-bottom:5px}
.inp2{width:100%;background:var(--foam);border:1px solid var(--steam);border-radius:9px;padding:9px 13px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--espresso);transition:border .2s;outline:none}
.inp2:focus{border-color:var(--ivy);box-shadow:0 0 0 3px rgba(61,107,74,.1)}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}

/* CLOCK */
.clock{background:linear-gradient(135deg,var(--espresso),#1E3A28);border-radius:18px;padding:24px 28px;color:var(--cream);margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 8px 32px rgba(26,15,10,.25);position:relative;overflow:hidden}
.clock::before{content:'üçÉ';position:absolute;right:22px;top:50%;transform:translateY(-50%);font-size:70px;opacity:.05}
.ctime{font-family:'DM Mono',monospace;font-size:42px;letter-spacing:2px;color:var(--latte);line-height:1}
.cdate{font-size:13px;color:rgba(232,221,208,.7);margin-top:4px}
.cactions{display:flex;flex-direction:column;gap:8px;align-items:flex-end}

/* ANNOUNCEMENT */
.ann{background:linear-gradient(135deg,var(--ivy),#2D5438);color:var(--cream);border-radius:12px;padding:13px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px;box-shadow:0 4px 16px rgba(61,107,74,.25)}
.ann-icon{font-size:17px;flex-shrink:0}
.ann-text{font-size:14px;line-height:1.5}
.ann-text strong{display:block;font-size:11px;letter-spacing:.5px;text-transform:uppercase;opacity:.75;margin-bottom:1px}

/* PROGRESS */
.pb{background:var(--steam);border-radius:99px;height:5px;overflow:hidden;margin-top:5px}
.pf{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--ivy),var(--ivy-light));transition:width .5s ease}

/* LOG */
.le{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--steam)}
.le:last-child{border-bottom:none}
.ld{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.ldg{background:var(--ivy)}.lda{background:var(--amber)}
.li{flex:1}
.ln{font-size:14px;font-weight:500}
.ldt{font-size:12px;color:var(--mocha)}
.lt{font-family:'DM Mono',monospace;font-size:12px;color:var(--caramel)}

/* PERF */
.pr{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.pn{width:90px;font-size:13px;font-weight:500;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pp{width:35px;text-align:right;font-family:'DM Mono',monospace;font-size:12px;color:var(--ivy);flex-shrink:0}

/* FILTER */
.fr{display:flex;gap:9px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
.fr select{width:auto;padding:7px 13px;background:var(--foam);border:1px solid var(--steam);border-radius:9px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--espresso);outline:none}

/* MODAL */
.mo{position:fixed;inset:0;z-index:200;background:rgba(26,15,10,.6);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center}
.mo.open{display:flex;animation:fadeIn .2s ease}
.modal{background:var(--warm-white);border-radius:18px;width:90%;max-width:480px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(26,15,10,.3)}
.mh{padding:18px 24px;border-bottom:1px solid var(--steam);display:flex;align-items:center;justify-content:space-between;background:var(--foam)}
.mt{font-family:'Playfair Display',serif;font-size:18px}
.mc{background:none;border:none;cursor:pointer;font-size:18px;color:var(--mocha);padding:3px 7px;border-radius:5px}
.mc:hover{background:var(--steam)}
.mb{padding:24px}

/* MISC */
.tv{font-family:'DM Mono',monospace;font-size:13px}
.wh{font-family:'DM Mono',monospace;font-size:13px;font-weight:500;color:var(--ivy)}
.vob{background:linear-gradient(135deg,rgba(61,107,74,.1),rgba(200,133,74,.08));border:1px solid rgba(61,107,74,.2);border-radius:10px;padding:11px 16px;display:flex;align-items:center;gap:9px;margin-bottom:16px;font-size:13px;color:var(--mocha)}

/* CALENDAR */
.cg{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-top:9px}
.cdl{font-size:10px;font-weight:600;text-transform:uppercase;color:var(--mocha);text-align:center;padding:3px}
.cd{aspect-ratio:1;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:10px;font-family:'DM Mono',monospace}
.cdp{background:rgba(61,107,74,.18);color:var(--ivy)}
.cda{background:rgba(184,84,80,.14);color:var(--red)}
.cdw{background:rgba(212,160,23,.12);color:var(--amber)}
.cdl2{background:rgba(200,133,74,.18);color:var(--caramel)}
.cde{background:transparent}
.cdt{outline:2px solid var(--ivy);outline-offset:1px}

::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--cream)}
::-webkit-scrollbar-thumb{background:var(--steam);border-radius:99px}

@media(max-width:768px){
  nav{padding:0 12px}.nav-badge{display:none}
  main{padding:12px}.g2{grid-template-columns:1fr}
  .clock{flex-direction:column;gap:14px}.ctime{font-size:34px}
  .sg{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<div id="loader"><div class="spin"></div><div class="load-txt" id="load-txt">Connecting...</div></div>

<div id="login-screen">
  <div class="login-box">
    <div class="login-icon">üçÉ</div>
    <div class="login-title">Trailing Ivy Caf√©</div>
    <div class="login-sub">Staff Attendance System</div>
    <div class="role-tabs">
      <div class="role-tab active" onclick="selRole('admin')" id="tab-admin">
        <span class="role-tab-icon">üîê</span>
        <div class="role-tab-name">Admin</div>
        <div class="role-tab-desc">Full access</div>
      </div>
      <div class="role-tab" onclick="selRole('user')" id="tab-user">
        <span class="role-tab-icon">üëÅÔ∏è</span>
        <div class="role-tab-name">Viewer</div>
        <div class="role-tab-desc">View only</div>
      </div>
    </div>
    <label class="lbl">Username</label>
    <input class="inp" type="text" id="lu" placeholder="Enter username" autocomplete="off">
    <label class="lbl">Password</label>
    <input class="inp" type="password" id="lp" placeholder="Enter password" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">Sign In ‚Üí</button>
    <div class="login-err" id="lerr">‚ùå Wrong username or password</div>
    <div class="login-hint"><strong>Admin:</strong> admin / admin123 &nbsp;|&nbsp; <strong>Viewer:</strong> viewer / view123</div>
  </div>
</div>

<div class="app" id="app" style="display:none">
<nav>
  <div class="nav-logo">üçÉ Trailing Ivy Caf√© <span class="nav-badge" id="rbadge">ADMIN</span></div>
  <div class="nav-tabs" id="ntabs"></div>
  <div class="nav-right">
    <div class="nav-user"><div class="avatar" id="navav">A</div><span id="navname">Admin</span></div>
    <button class="logout-btn" onclick="doLogout()">Sign Out</button>
  </div>
</nav>
<main>

<!-- ADMIN DASHBOARD -->
<div class="panel" id="panel-admin">
  <div class="ph"><div><div class="pt">Good Morning ‚òï</div><div class="ps">Admin Dashboard ‚Äî Full Access</div></div><div class="dbadge" id="hdate">‚Äî</div></div>
  <div class="ann"><div class="ann-icon">üçÉ</div><div class="ann-text"><strong>Announcement</strong>Welcome to Trailing Ivy Caf√© Attendance System!</div></div>
  <div class="sg">
    <div class="sc g"><div class="sl">Present Today</div><div class="sv" id="s1">‚Äî</div><div class="ss">of <span id="s1t">‚Äî</span> staff</div></div>
    <div class="sc r"><div class="sl">Absent</div><div class="sv" id="s2">‚Äî</div></div>
    <div class="sc a"><div class="sl">Week Off</div><div class="sv" id="s3">‚Äî</div></div>
    <div class="sc"><div class="sl">Late Today</div><div class="sv" id="s4">‚Äî</div></div>
    <div class="sc"><div class="sl">Avg Hours</div><div class="sv" id="s5">‚Äî</div></div>
  </div>
  <div class="g2">
    <div class="card"><div class="ch"><div class="ct">Today's Log</div><button class="btn btn-ivy btn-sm" onclick="openM('m-log')">+ Log Entry</button></div><div class="cb" id="tlog"></div></div>
    <div class="card"><div class="ch"><div class="ct">On Break</div><span class="badge bl">Live</span></div><div class="cb" id="blog"></div></div>
  </div>
  <div class="card">
    <div class="ch"><div class="ct">Attendance Register</div><button class="btn btn-o btn-sm" onclick="exportCSV()">‚¨á Export</button></div>
    <div class="cb"><div class="tw"><table><thead><tr><th>ID</th><th>Name</th><th>Role</th><th>Check-In</th><th>Break</th><th>Check-Out</th><th>Status</th><th>Hrs</th><th>Edit</th></tr></thead><tbody id="atbody"></tbody></table></div></div>
  </div>
</div>

<!-- CHECK-IN -->
<div class="panel" id="panel-checkin">
  <div class="ph"><div><div class="pt">Time Terminal</div><div class="ps">Log check-in, breaks & check-out</div></div><div class="dbadge" id="cidate">‚Äî</div></div>
  <div class="clock">
    <div><div class="ctime" id="clk">00:00:00</div><div class="cdate" id="clkd">Loading...</div></div>
    <div class="cactions">
      <select id="cisel" style="background:rgba(255,255,255,.1);border:1px solid rgba(245,239,228,.2);color:var(--cream);border-radius:9px;padding:7px 13px;font-size:13px;outline:none;min-width:170px;"></select>
      <div style="display:flex;gap:7px;flex-wrap:wrap;justify-content:flex-end">
        <button class="btn btn-sm btn-g" onclick="logA('ci')">‚úì Check-In</button>
        <button class="btn btn-sm btn-c" onclick="logA('bs')">‚è∏ Break</button>
        <button class="btn btn-sm btn-o" style="color:var(--cream);border-color:rgba(245,239,228,.3)" onclick="logA('be')">‚ñ∂ Resume</button>
        <button class="btn btn-sm btn-r" onclick="logA('co')">‚úó Check-Out</button>
      </div>
    </div>
  </div>
  <div class="card"><div class="ch"><div class="ct">Current Status</div></div><div class="cb"><div id="scards" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:9px"></div></div></div>
</div>

<!-- REPORTS -->
<div class="panel" id="panel-reports">
  <div class="ph"><div><div class="pt">Monthly Reports</div><div class="ps">Analytics & performance</div></div></div>
  <div class="fr">
    <select id="rm" onchange="renderRpt()"><option value="0">January</option><option value="1">February</option><option value="2">March</option><option value="3">April</option><option value="4">May</option><option value="5">June</option><option value="6">July</option><option value="7">August</option><option value="8">September</option><option value="9">October</option><option value="10">November</option><option value="11">December</option></select>
    <select id="ry" onchange="renderRpt()"><option>2025</option><option selected>2026</option></select>
    <button class="btn btn-o btn-sm" onclick="exportCSV()">‚¨á Export</button>
  </div>
  <div class="sg" id="rsStats"></div>
  <div class="g2">
    <div class="card"><div class="ch"><div class="ct">Attendance %</div></div><div class="cb" id="rchart"></div></div>
    <div class="card"><div class="ch"><div class="ct">Monthly Summary</
